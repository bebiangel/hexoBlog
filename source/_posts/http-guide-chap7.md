---
title: HTTP 완벽가이드 7장
date: 2019-09-29 14:47:26
tags: [HTTP, 스터디]
categories: [스터디]
---
# 7장 캐시

웹 캐시는 자주 쓰이는 문서의 사본을 자동으로 보관하는 HTTP 장치다.

웹 요청이 캐시에 도착했을 때, 캐시된 로컬 사본이 존재한다면, 그 문서는 원 서버가 아니라 그 캐시로 부터 제공된다.

## 7.1 불필요한 데이터 전송

- 다수의 클라이언트가 하나의 페이지를 서버에 요청시에 서버는 같은 문서를 네트워크를 통해 각각 전송한다.
- 값비싼 네트워크 대역폭을 잡아먹고, 전송을 느리게 만들며, 웹 서버에 부하를 준다.

## 7.2 대역폭 병목

- 캐시는 네크워크 병목을 줄여준다.
- 많은 네트워크가 원격 서버보다 로컬 네트워크 클라이언트에 더 넓은 대역폭을 제공한다.

## 7.3 갑작스런 요청 쇄도(Flash Crowds)

- 많은 사람들이 거의 동시에 웹 문서에 접근할 때 트래픽이 급증하고 네트워크와 웹 서버의 장애를 일으키는데,  `캐싱`은 중요한 역할을 한다.

## 7.4 거리로 인한 지연

- 클라이언트와 서버 사이에 라우터가 그지 많지 않더라도, 빛의 속도 그 자체가 유의미한 지연을 유발한다.
- 클라이언트와 서버간의 거리가 멀수록, 커넥션의 개수가 많아지면, 네트워크 지연은 커지게 된다.

## 7.5 적중과 부적중

`캐시 적중(cache hit)`이란 캐시에 요청이 도착했을 때, 만약 그에 대응하는 사본이 있다면 그것을 이용해 요청을 처리하는 것이다.

`캐시 부적중(cache miss)`이란  대응하는 사본이 없다면 그냥 원 서버로 전달된다.

### 7.5.1 재검사(Revalidation)

- 원 서버 리소스는 변경될 수 있기 때문에, 반드시 그들이 갖고 있는 사본이 최신인지 서버를 통해서 점검해야한다.
- `신선도 검사`를  `HTTP 재검사`라고 부른다.
- 캐시는 스스로 원한다면 언제든지 사본을 재검사할 수 있다.
- 캐시가 문서를 수백만 개씩 갖고 있는 경우에는 네트워크 대역폭이 부족하므로, 캐시는 클라이언트가 사본을 요청하였으며 그 사본이 검사를 할 필요가 있을 정도로 충분히 오래된 경우에만 재검사를 한다.

### 7.5.2 적중률

- 캐시가 요청을 처리하는 비율을 `캐시 적중률` 이라고 부른다.
- 캐시 적중률이 100%에 근접할 수록 모든 요청이 캐시에 적중한 것이다.
- 일반적으로 40%면 웹 캐시로 괜찮다고 본다.

### 7.5.3 바이트 적중률

- 문서들이 모든 같은 크기가 아니기 때문에 문서 적중률이 모든 것을 말해주지 않는다.
- 바이트 단위 적중률은 캐시를 통해 제공된 모든 바이트의 비율을 표현한다.
- 문서 적중률을 개선하면 전체 대기시간(지연)이 줄어든다.
- 바이트 단위 적중률은 얼마나 많은 바이트가 인터넷으로 나가지 않았는지 보여준다.
- 바이트 단위 적중률을 개선하면 대역폭 절약을 최적화한다.

### 7.5.4  적중과 부적중의 구별

- HTTP는 클라이언트에게 응답이 캐시 적중이었는지 아니었는지에 대해서 말해주지 않는다.
- 클라이언트는 Date 헤더 값을 현재 시각과 비교하여, 응답의 생성일이 더 오래되었다면 클라이언트는 응답이 캐시된 것임을 알아낼 수 있다.

## 7.6 캐시 토폴로지

### 7.6.1 개인 전용 캐시

- 많은 에너지나 저장 공간을 필요로 하지 않으므로, 작고 저렴하다.
- 웹 브라우저는 개인 전용 캐시를 내장하고 있다.
- 대부분의 브라우저는 자주 쓰이는 문서를 개인용 컴퓨터의 디스크와 메모리에 캐시해 놓고, 사용자가 캐시 사이즈와 설정을 수정할 수 있도록 허용한다.
- 크롬에서는 특별한 url인 `about:cache` 를 통해 확인한다.

### 7.6.2 공용 프락시 캐시

- 로컬 캐시에서 문서를 제공하거나, 혹은 사용자의 입장에서 서버에 접근한다.
- 공용 캐시에는 여러 사용자가 접근하기 때문에, 불필요한 트래픽을 줄일 수가 있다.
- 캐시는 자주 찾는 객체를 단 한 번만 가져와 모든 요청에 대해 공유된 사본을 제공하여 네트워크 트래픽을 줄인다.

### 7.6.3 프락시 캐시 계층들

- 작은 캐시에서 캐시 부적중이 발생했을 때 더 큰 부모 캐시가 그 '걸러 남겨진' 트래픽을 처리하도록 하는 계층 을 만드는 방식이 합리적인 경우가 있다.
- 클라이언트 주위에는 작고 저렴한 캐시를 사용하고, 계층 상단에는 많은 사용자들에 의해 공유되는 문서를 유지하기 위해 더 크고 강력한 캐시를 사용한다.

![](/images/http-guide-chap7_1.png)

- 캐시 계층이 깊다면 캐시의 긴 연쇄를 따라가게 되고, 각 중간 프락시는 성능 저하가 발생한다.

### 7.6.4 캐시망, 콘텐츠 라우팅, 피어링

- 네트워크 아키텍쳐 중 `캐시망`을 만들고 복잡한 방법으로 서로 대화하여, 어떤 부모 캐시와 대화할 것인지, 아니면 요청이 캐시를 완전히 우회해서 원 서버로 바로 가도록 할것인지에 대한 커뮤니케이션 결정을 내린다.